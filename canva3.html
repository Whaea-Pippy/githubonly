<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Count the Cars & Trucks!</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .vehicle {
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      filter: drop-shadow(0 6px 14px rgba(0,0,0,0.25));
      animation: gentleDrive 4s ease-in-out infinite alternate;
    }

    @keyframes gentleDrive {
      0% { transform: translateX(0) translateY(0); }
      100% { transform: translateX(8px) translateY(-6px); }
    }

    .vehicle:hover {
      transform: scale(1.25) translateY(-15px) rotate(4deg) !important;
      filter: drop-shadow(0 12px 30px rgba(0,0,0,0.4));
    }

    .vehicle:active {
      animation: bounce 0.3s ease-out;
    }

    @keyframes bounce {
      0%, 100% { transform: scale(1.1); }
      50% { transform: scale(1.2); }
    }

    .vehicle.counted {
      opacity: 0.5;
      cursor: default;
      animation: none !important;
    }

    .count-badge {
      animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes popIn {
      0% { transform: scale(0) rotate(-180deg); opacity: 0; }
      100% { transform: scale(1) rotate(0); opacity: 1; }
    }

    .game-background {
      background: linear-gradient(135deg, #87CEEB 0%, #B8E6F2 30%, #D4F4DD 60%, #F0F8D4 100%);
      background-size: 400% 400%;
      animation: softGradientShift 30s ease infinite;
    }

    @keyframes softGradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .play-area {
      border: 8px dashed #FFFFFF;
      border-radius: 2rem;
      box-shadow: inset 0 0 40px rgba(255,255,255,0.4), 0 0 30px rgba(0,0,0,0.1);
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(4px);
    }

    @media (max-width: 640px) {
      .vehicle svg { width: 140px !important; height: 90px !important; }
    }
    @media (min-width: 641px) and (max-width: 1024px) {
      .vehicle svg { width: 180px !important; height: 110px !important; }
    }
    @media (min-width: 1025px) {
      .vehicle svg { width: 220px !important; height: 135px !important; }
    }
  </style>
</head>
<body class="h-screen w-screen overflow-hidden game-background flex flex-col">
  <header class="w-full text-center py-4 md:py-6 px-4 flex-shrink-0">
    <h1 class="text-4xl md:text-6xl lg:text-7xl font-black text-white drop-shadow-2xl" style="font-family: 'Arial Black', Arial, sans-serif; text-shadow: 3px 3px 8px rgba(0,0,0,0.5);">
      Count the cars & trucks!
      <span id="counter-header" class="block text-2xl md:text-4xl lg:text-5xl mt-2 text-yellow-300 font-bold drop-shadow-lg">0 / 8</span>
    </h1>
  </header>

  <main class="flex-1 px-4 pb-4 md:px-8 md:pb-8">
    <div class="play-area relative h-full w-full">
      <div id="vehicles-container" class="absolute inset-0"></div>
    </div>
  </main>

  <div id="completion-modal" class="fixed inset-0 flex items-center justify-center z-50 pointer-events-none">
    <div class="px-10 py-12 md:px-16 md:py-16 rounded-3xl shadow-2xl text-white text-center pointer-events-auto backdrop-blur-lg border-8 border-white/30 hidden" style="background: linear-gradient(135deg, #10B981, #059669); max-width: 90vw;">
      <p class="text-4xl md:text-6xl font-black mb-8 drop-shadow-2xl">Awesome!</p>
      <p id="completion-text" class="text-3xl md:text-5xl font-bold mb-10"></p>
      <button class="bg-white/30 hover:bg-white/50 backdrop-blur px-12 py-6 rounded-full text-3xl md:text-4xl font-black transition-all hover:scale-110 shadow-2xl">
        Play Again!
      </button>
    </div>
  </div>

  <script>
    const config = {
      completion_message: "There are {count} vehicles!"
    };

    let countedVehicles = new Set();
    let totalVehicles = Math.floor(Math.random() * 9) + 2; // Strictly 2 to 10

    const vibrantColors = ['#FF6B6B', '#FF8E53', '#FFD93D', '#6BCF7F', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57', '#FF9FF3', '#54A0FF', '#48DBFB', '#A0E7E5', '#F7DC6F'];

    const vehicleTemplates = [
      (c1, c2, c3) => `<path d="M12 35 Q8 30 18 25 Q45 18 78 25 Q92 30 88 35 Q78 40 55 45 Q28 48 18 43 L12 35 Z" fill="${c1}"/>
        <path d="M38 20 Q48 15 58 20 L62 32 L52 32 Z" fill="${c2}"/>
        <g fill="#333" stroke="#fff" stroke-width="1.5"><circle cx="28" cy="52" r="7"/><circle cx="72" cy="52" r="7"/></g>
        <rect x="42" y="22" width="16" height="7" rx="2" fill="#87CEEB" opacity="0.7"/>
        <circle cx="82" cy="37" r="2.5" fill="${c3}"/>`,
      (c1, c2, c3) => `<path d="M10 32 Q6 29 16 26 Q55 20 84 26 Q94 29 90 33 Q80 37 55 42 Q25 45 16 41 L10 32 Z" fill="${c1}"/>
        <path d="M42 17 Q52 13 62 17 L67 31 L57 31 Z" fill="${c2}"/>
        <g fill="#333" stroke="#fff" stroke-width="1.5"><circle cx="25" cy="49" r="8"/><circle cx="75" cy="49" r="8"/></g>
        <rect x="46" y="19" width="18" height="8" rx="3" fill="#87CEEB" opacity="0.7"/>
        <circle cx="80" cy="34" r="3" fill="${c3}"/>`,
      (c1, c2, c3) => `<path d="M18 30 Q15 28 22 26 L78 26 Q82 28 78 30 L78 38 Q82 40 78 42 L22 42 Q18 40 22 38 Z" fill="${c1}"/>
        <path d="M25 15 Q38 10 52 15 L62 30 L52 30 Z" fill="${c2}"/>
        <g fill="#333" stroke="#fff" stroke-width="1.5"><circle cx="32" cy="50" r="8"/><circle cx="68" cy="50" r="8"/></g>
        <rect x="36" y="18" width="20" height="8" rx="2" fill="#87CEEB" opacity="0.7"/>
        <circle cx="72" cy="32" r="3" fill="${c3}"/>`,
      (c1, c2, c3) => `<rect x="12" y="25" width="76" height="22" rx="8" fill="${c1}"/>
        <path d="M20 12 Q32 6 48 12 L58 28 L48 28 Z" fill="${c2}"/>
        <g fill="#333" stroke="#fff" stroke-width="1.5"><circle cx="30" cy="50" r="8"/><circle cx="70" cy="50" r="8"/></g>
        <rect x="34" y="15" width="22" height="9" rx="3" fill="#87CEEB" opacity="0.7"/>
        <circle cx="75" cy="29" r="3" fill="${c3}"/>`
    ];

    function generateVehicles() {
      const container = document.getElementById('vehicles-container');
      container.innerHTML = '';
      countedVehicles.clear();

      const positions = [];
      const minDistance = 60;
      const safeMarginPercent = 12;

      for (let i = 0; i < totalVehicles; i++) {
        let attempts = 0;
        let pos;
        do {
          pos = {
            top: safeMarginPercent + Math.random() * (100 - 2 * safeMarginPercent),
            left: safeMarginPercent + Math.random() * (100 - 2 * safeMarginPercent),
            rotation: Math.random() * 16 - 8
          };
          const tooClose = positions.some(p => Math.hypot(pos.top - p.top, pos.left - p.left) < minDistance);
          attempts++;
        } while (tooClose && attempts < 300);
        positions.push(pos);

        const templateIdx = Math.floor(Math.random() * vehicleTemplates.length);
        const colors = [...vibrantColors].sort(() => 0.5 - Math.random()).slice(0, 3);
        const svgContent = vehicleTemplates[templateIdx](...colors);

        const vehicleEl = document.createElement('div');
        vehicleEl.className = 'vehicle absolute';
        vehicleEl.dataset.id = i;
        vehicleEl.style.top = `${pos.top}%`;
        vehicleEl.style.left = `${pos.left}%`;
        vehicleEl.style.transform = `translate(-50%, -50%) rotate(${pos.rotation}deg)`;
        vehicleEl.style.animationDelay = `${i * 0.4}s`;

        vehicleEl.innerHTML = `
          <svg viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
            <g>${svgContent}</g>
          </svg>
          <div class="count-badge absolute -top-8 -right-8 bg-white text-gray-800 rounded-full w-24 h-24 flex items-center justify-center text-4xl font-black shadow-2xl border-8 border-yellow-400" style="display:none;"></div>
        `;

        container.appendChild(vehicleEl);
      }

      updateCounter();
      attachEventListeners();
    }

    function updateCounter() {
      document.getElementById('counter-header').textContent = `${countedVehicles.size} / ${totalVehicles}`;
    }

    function attachEventListeners() {
      document.querySelectorAll('.vehicle').forEach(v => {
        v.onclick = () => {
          if (countedVehicles.has(v.dataset.id)) return;

          countedVehicles.add(v.dataset.id);
          v.classList.add('counted');

          const badge = v.querySelector('.count-badge');
          badge.textContent = countedVehicles.size;
          badge.style.display = 'flex';

          speakNumber(countedVehicles.size);

          updateCounter();

          if (countedVehicles.size === totalVehicles) {
            setTimeout(showCompletion, 900);
          }
        };
      });

      document.querySelector('#completion-modal button').onclick = resetGame;
    }

    function speakNumber(num) {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(num.toString());
        utter.lang = 'en-US';
        utter.rate = 0.8;
        utter.pitch = 1.1;
        utter.volume = 1;
        speechSynthesis.speak(utter);
      }
    }

    function showCompletion() {
      document.getElementById('completion-text').textContent = config.completion_message.replace('{count}', totalVehicles);
      document.querySelector('#completion-modal > div').classList.remove('hidden');
      speakNumber(totalVehicles);
    }

    function resetGame() {
      totalVehicles = Math.floor(Math.random() * 9) + 2; // 2â€“10 again
      document.querySelector('#completion-modal > div').classList.add('hidden');
      speechSynthesis.cancel();
      generateVehicles();
    }

    generateVehicles();

    window.addEventListener('resize', generateVehicles);
    window.addEventListener('orientationchange', () => setTimeout(generateVehicles, 300));
  </script>
</body>
</html>

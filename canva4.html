<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Count the Cars & Trucks!</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; padding: 0; box-sizing: border-box; height: 100vh; width: 100vw; }
    .vehicle { 
      cursor: pointer; 
      position: absolute;
      transition: all 0.4s ease;
      filter: drop-shadow(0 6px 14px rgba(0,0,0,0.3));
      animation: gentleDrive 4s ease-in-out infinite alternate;
    }
    @keyframes gentleDrive { 0% { transform: translateX(0) translateY(0); } 100% { transform: translateX(8px) translateY(-6px); } }
    .vehicle:hover { transform: translate(-50%, -50%) scale(1.3) rotate(5deg) !important; }
    .vehicle.counted { opacity: 0.5; cursor: default; animation: none; }
    .count-badge { 
      animation: popIn 0.4s ease; 
      position: absolute; 
      top: -40px; 
      right: -40px; 
      background: white; 
      color: #1F2937; 
      width: 80px; 
      height: 80px; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 3rem; 
      font-weight: bold; 
      box-shadow: 0 8px 20px rgba(0,0,0,0.3); 
      border: 6px solid #FBBF24; 
    }
    @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .game-background { 
      background: linear-gradient(135deg, #87CEEB, #B8E6F2, #D4F4DD, #F0F8D4); 
      height: 100%; 
      width: 100%; 
    }
    .play-area { 
      border: 10px dashed white; 
      border-radius: 2rem; 
      background: rgba(255,255,255,0.1); 
      backdrop-filter: blur(5px); 
      height: 100%; 
      position: relative; 
    }
  </style>
</head>
<body class="game-background flex flex-col">
  <header class="text-center py-6">
    <h1 class="text-5xl md:text-7xl font-black text-white" style="text-shadow: 4px 4px 10px rgba(0,0,0,0.6);">
      Count the cars & trucks!
      <div id="counter-header" class="text-3xl md:text-5xl text-yellow-300 font-bold mt-4">0 / 7</div>
    </h1>
  </header>

  <main class="flex-1 px-4 pb-4">
    <div class="play-area">
      <div id="vehicles-container"></div>
    </div>
  </main>

  <div id="completion-modal" class="fixed inset-0 flex items-center justify-center pointer-events-none z-50">
    <div class="bg-gradient-to-br from-green-500 to-emerald-600 px-12 py-16 rounded-3xl text-white text-center shadow-2xl pointer-events-auto border-8 border-white/40 max-w-lg hidden">
      <p class="text-5xl font-black mb-8">Awesome!</p>
      <p id="completion-text" class="text-4xl mb-12"></p>
      <button class="bg-white/30 hover:bg-white/50 px-12 py-6 rounded-full text-4xl font-black">
        Play Again!
      </button>
    </div>
  </div>

  <script>
    let countedVehicles = new Set();
    let totalVehicles = Math.floor(Math.random() * 9) + 2; // 2 to 10

    document.getElementById('counter-header').textContent = `0 / ${totalVehicles}`;

    const colors = ['#FF6B6B', '#FF8E53', '#FFD93D', '#6BCF7F', '#4ECDC4', '#45B7D1', '#FECA57', '#FF9FF3', '#54A0FF'];

    const templates = [
      (body, cab, light) => `<rect x="10" y="25" width="80" height="20" rx="8" fill="${body}"/>
        <path d="M20 15 Q35 5 50 15 L60 28 L50 28 Z" fill="${cab}"/>
        <circle cx="25" cy="50" r="10" fill="#333" stroke="#fff" stroke-width="2"/>
        <circle cx="75" cy="50" r="10" fill="#333" stroke="#fff" stroke-width="2"/>
        <rect x="40" y="20" width="20" height="10" rx="3" fill="#87CEEB" opacity="0.7"/>
        <circle cx="80" cy="30" r="4" fill="${light}"/>`,
      (body, cab, light) => `<path d="M15 35 Q10 30 20 25 Q50 18 80 25 Q90 30 85 35 Q75 42 50 45 Q25 45 15 35 Z" fill="${body}"/>
        <path d="M40 18 Q50 12 60 18 L65 30 L55 30 Z" fill="${cab}"/>
        <circle cx="28" cy="52" r="9" fill="#333" stroke="#fff" stroke-width="2"/>
        <circle cx="72" cy="52" r="9" fill="#333" stroke="#fff" stroke-width="2"/>
        <rect x="45" y="22" width="15" height="8" rx="2" fill="#87CEEB" opacity="0.7"/>
        <circle cx="82" cy="35" r="3" fill="${light}"/>`,
      (body, cab, light) => `<rect x="20" y="28" width="60" height="18" rx="6" fill="${body}"/>
        <path d="M25 15 Q40 8 55 15 L65 30 L55 30 Z" fill="${cab}"/>
        <circle cx="35" cy="50" r="10" fill="#333" stroke="#fff" stroke-width="2"/>
        <circle cx="65" cy="50" r="10" fill="#333" stroke="#fff" stroke-width="2"/>
        <rect x="38" y="18" width="24" height="10" rx="3" fill="#87CEEB" opacity="0.7"/>
        <circle cx="75" cy="32" r="4" fill="${light}"/>`
    ];

    function createVehicle() {
      const container = document.getElementById('vehicles-container');
      container.innerHTML = '';

      const positions = [];
      const margin = 15;

      for (let i = 0; i < totalVehicles; i++) {
        let pos;
        let attempts = 0;
        do {
          pos = {
            top: margin + Math.random() * (100 - 2 * margin),
            left: margin + Math.random() * (100 - 2 * margin)
          };
          attempts++;
        } while (positions.some(p => Math.hypot(p.top - pos.top, p.left - pos.left) < 50) && attempts < 200);
        positions.push(pos);

        const div = document.createElement('div');
        div.className = 'vehicle';
        div.dataset.id = i;
        div.style.top = pos.top + '%';
        div.style.left = pos.left + '%';
        div.style.transform = 'translate(-50%, -50%)';

        const template = templates[Math.floor(Math.random() * templates.length)];
        const c = colors.sort(() => Math.random() - 0.5);
        const svg = template(c[0], c[1], c[2]);

        div.innerHTML = `
          <svg width="200" height="120" viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg">
            <g>${svg}</g>
          </svg>
          <div class="count-badge" style="display:none;"></div>
        `;

        container.appendChild(div);
      }

      document.querySelectorAll('.vehicle').forEach(v => {
        v.onclick = () => {
          if (countedVehicles.has(v.dataset.id)) return;
          countedVehicles.add(v.dataset.id);
          v.classList.add('counted');
          v.querySelector('.count-badge').textContent = countedVehicles.size;
          v.querySelector('.count-badge').style.display = 'flex';
          document.getElementById('counter-header').textContent = `${countedVehicles.size} / ${totalVehicles}`;
          if ('speechSynthesis' in window) {
            speechSynthesis.cancel();
            speechSynthesis.speak(new SpeechSynthesisUtterance(countedVehicles.size.toString()));
          }
          if (countedVehicles.size === totalVehicles) {
            setTimeout(() => {
              document.getElementById('completion-text').textContent = `There are ${totalVehicles} vehicles!`;
              document.querySelector('#completion-modal > div').classList.remove('hidden');
              speechSynthesis.speak(new SpeechSynthesisUtterance(totalVehicles.toString()));
            }, 800);
          }
        };
      });
    }

    document.querySelector('#completion-modal button').onclick = () => {
      countedVehicles.clear();
      totalVehicles = Math.floor(Math.random() * 9) + 2;
      document.getElementById('counter-header').textContent = `0 / ${totalVehicles}`;
      document.querySelector('#completion-modal > div').classList.add('hidden');
      createVehicle();
    };

    createVehicle();
  </script>
</body>
</html>

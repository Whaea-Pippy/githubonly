<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Count the Cars & Trucks!</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    .vehicle {
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      filter: drop-shadow(0 4px 12px rgba(0,0,0,0.2));
      animation: gentleDrive 3s ease-in-out infinite alternate;
    }

    @keyframes gentleDrive {
      0% { transform: translateX(0px) translateY(0px); }
      100% { transform: translateX(6px) translateY(-4px); }
    }

    .vehicle:hover {
      transform: scale(1.2) translateY(-12px) rotate(3deg) !important;
      filter: drop-shadow(0 8px 20px rgba(0,0,0,0.3));
    }

    .vehicle:active {
      animation: bounce 0.3s ease-out;
    }

    @keyframes bounce {
      0%, 100% { transform: scale(1) translateY(0px); }
      50% { transform: scale(1.1) translateY(-6px); }
    }

    .vehicle.counted {
      opacity: 0.5;
      cursor: default;
      animation: none !important;
      transform: translate(-50%, -50%) !important;
    }

    .vehicle.counted:hover {
      transform: translate(-50%, -50%) !important;
    }

    .count-badge {
      animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes popIn {
      0% { transform: scale(0) rotate(-180deg); opacity: 0; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }

    .completion-modal {
      animation: slideDown 0.5s ease-out;
    }

    @keyframes slideDown {
      0% { transform: translateY(-100%); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }

    .game-background {
      background: linear-gradient(135deg, #87CEEB 0%, #B8E6F2 25%, #D4F4DD 50%, #F0F8D4 75%, #E8F5E8 100%);
      background-size: 400% 400%;
      animation: softGradientShift 25s ease infinite;
    }

    @keyframes softGradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @media (max-width: 768px) {
      .vehicle svg { width: 140px !important; height: 95px !important; }
      #counter { font-size: 2rem !important; padding: 1rem 2rem !important; }
      .play-area { min-height: 60vh !important; }
    }

    @media (max-width: 480px) {
      .vehicle svg { width: 120px !important; height: 85px !important; }
      .play-area { min-height: 55vh !important; }
    }
  </style>
</head>
<body class="h-screen overflow-hidden game-background">
  <div id="app" class="w-full h-full flex flex-col items-center justify-start px-4 pt-8 pb-6 md:px-12 md:pt-12 md:pb-8">
    <!-- Content injected by JS -->
  </div>

  <script>
    const config = {
      game_title: "Count the cars & trucks!",
      completion_message: "Awesome! There are {count} vehicles!",
      counter_bg_color: "#FFFFFF",
      counter_text_color: "#1F2937",
      completion_bg_color: "#10B981",
      font_family: "'Arial Black', Arial, system-ui, sans-serif",
      font_size: 18
    };

    let countedVehicles = new Set();
    let totalVehicles = Math.floor(Math.random() * 7) + 4; // 4â€“10

    const vibrantColors = [
      '#FF6B6B', '#FF8E53', '#FFD93D', '#6BCF7F', '#4ECDC4', '#45B7D1',
      '#96CEB4', '#FECA57', '#FF9FF3', '#54A0FF', '#48DBFB', '#A0E7E5', '#F7DC6F'
    ];

    const vehicleTemplates = [
      // Compact Car 1
      (c1, c2, c3) =>
        '<path d="M12 35 Q8 30 18 25 Q45 18 78 25 Q92 30 88 35 Q78 40 55 45 Q28 48 18 43 L12 35 Z" fill="' + c1 + '"/>' +
        '<path d="M38 20 Q48 15 58 20 L62 32 L52 32 Z" fill="' + c2 + '"/>' +
        '<g fill="#333" stroke="#fff" stroke-width="1.5"><circle cx="28" cy="52" r="7"/><circle cx="72" cy="52" r="7"/></g>' +
        '<rect x="42" y="22" width="16" height="7" rx="2" fill="#87CEEB" opacity="0.7"/>' +
        '<circle cx="82" cy="37" r="2.5" fill="' + c3 + '"/>',
      // SUV Car 2
      (c1, c2, c3) =>
        '<path d="M10 32 Q6 29 16 26 Q55 20 84 26 Q94 29 90 33 Q80 37 55 42 Q25 45 16 41 L10 32 Z" fill="' + c1 + '"/>' +
        '<path d="M42 17 Q52 13 62 17 L67 31 L57 31 Z" fill="' + c2 + '"/>' +
        '<g fill="#333" stroke="#fff" stroke-width="1.5"><circle cx="25" cy="49" r="8"/><circle cx="75" cy="49" r="8"/></g>' +
        '<rect x="46" y="19" width="18" height="8" rx="3" fill="#87CEEB" opacity="0.7"/>' +
        '<circle cx="80" cy="34" r="3" fill="' + c3 + '"/>',
      // Pickup Truck 1
      (c1, c2, c3) =>
        '<path d="M18 30 Q15 28 22 26 L78 26 Q82 28 78 30 L78 38 Q82 40 78 42 L22 42 Q18 40 22 38 Z" fill="' + c1 + '"/>' +
        '<path d="M25 15 Q38 10 52 15 L62 30 L52 30 Z" fill="' + c2 + '"/>' +
        '<g fill="#333" stroke="#fff" stroke-width="1.5"><circle cx="32" cy="50" r="8"/><circle cx="68" cy="50" r="8"/></g>' +
        '<rect x="36" y="18" width="20" height="8" rx="2" fill="#87CEEB" opacity="0.7"/>' +
        '<circle cx="72" cy="32" r="3" fill="' + c3 + '"/>',
      // Box Truck 2
      (c1, c2, c3) =>
        '<rect x="12" y="25" width="76" height="22" rx="8" fill="' + c1 + '"/>' +
        '<path d="M20 12 Q32 6 48 12 L58 28 L48 28 Z" fill="' + c2 + '"/>' +
        '<g fill="#333" stroke="#fff" stroke-width="1.5"><circle cx="30" cy="50" r="8"/><circle cx="70" cy="50" r="8"/></g>' +
        '<rect x="34" y="15" width="22" height="9" rx="3" fill="#87CEEB" opacity="0.7"/>' +
        '<circle cx="75" cy="29" r="3" fill="' + c3 + '"/>'
    ];

    function renderGame() {
      const app = document.getElementById('app');

      app.innerHTML = `
        <h1 id="game-title" class="text-5xl md:text-6xl font-black mb-8 md:mb-12 text-center drop-shadow-lg" style="color: ${config.counter_text_color}; font-family: ${config.font_family}; font-size: ${config.font_size * 2.5}px; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);">
          ${config.game_title}
        </h1>

        <div id="counter" class="px-10 py-5 md:px-12 md:py-6 rounded-full shadow-2xl font-black mb-10 md:mb-14 text-3xl md:text-4xl tracking-wide" style="background: ${config.counter_bg_color}; color: ${config.counter_text_color}; font-family: ${config.font_family}; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
          0 / ${totalVehicles}
        </div>

        <div class="play-area relative w-full flex-1 max-w-6xl mx-auto overflow-hidden" style="min-height: 65vh;">
          ${generateVehicles()}
        </div>

        <div id="completion-modal" class="fixed top-16 md:top-20 left-1/2 transform -translate-x-1/2 z-50 px-12 md:px-16 py-10 md:py-12 rounded-3xl shadow-2xl text-white text-center hidden backdrop-blur-md border-4 border-white/20">
          <p class="text-3xl md:text-4xl lg:text-5xl font-black mb-8 drop-shadow-lg"></p>
          <button class="bg-white/20 hover:bg-white/40 backdrop-blur-sm px-10 md:px-12 py-4 md:py-5 rounded-full text-xl md:text-2xl font-black transition-all duration-300 shadow-2xl hover:scale-105">
            ðŸš€ Play Again! ðŸš€
          </button>
        </div>
      `;

      updateCounter();
      attachEventListeners();
    }

    function generateVehicles() {
      const positions = [];
      const minDistance = 55;
      const safeMarginPercent = 20;

      for (let i = 0; i < totalVehicles; i++) {
        let attempts = 0;
        let newPos;
        let tooClose;

        do {
          newPos = {
            top: safeMarginPercent + Math.random() * (100 - 2 * safeMarginPercent),
            left: safeMarginPercent + Math.random() * (100 - 2 * safeMarginPercent),
            rotation: (Math.random() * 10 - 5) // Subtle tilt for realism
          };

          tooClose = positions.some(pos => {
            const dx = newPos.top - pos.top;
            const dy = newPos.left - pos.left;
            return Math.sqrt(dx * dx + dy * dy) < minDistance;
          });

          attempts++;
          if (attempts > 300) break;
        } while (tooClose);

        positions.push(newPos);
      }

      return positions.map((pos, index) => {
        const templateIdx = Math.floor(Math.random() * vehicleTemplates.length);
        const colors = [...vibrantColors].sort(() => 0.5 - Math.random()).slice(0, 3);
        const details = vehicleTemplates[templateIdx](colors[0], colors[1], colors[2]);
        const delay = (index * 0.4) + 's';

        return `
          <div class="vehicle absolute" data-id="${index}" style="top: ${pos.top}%; left: ${pos.left}%; transform: translate(-50%, -50%) rotate(${pos.rotation}deg); animation-delay: ${delay};">
            <svg width="160" height="100" viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg" class="drop-shadow-2xl">
              <g>
                ${details}
              </g>
            </svg>
            <div class="count-badge absolute -top-6 -right-6 bg-gradient-to-br from-white to-gray-100 text-gray-800 rounded-full w-20 h-20 flex items-center justify-center text-3xl font-black shadow-2xl border-4 border-white/50" style="display: none;"></div>
          </div>
        `;
      }).join('');
    }

    function attachEventListeners() {
      document.querySelectorAll('.vehicle').forEach(vehicle => {
        vehicle.addEventListener('click', handleVehicleClick);
      });

      const resetBtn = document.querySelector('#completion-modal button');
      if (resetBtn) {
        resetBtn.addEventListener('click', resetGame);
      }
    }

    function handleVehicleClick(e) {
      const vehicle = e.currentTarget;
      const id = vehicle.dataset.id;

      if (countedVehicles.has(id)) return;

      countedVehicles.add(id);
      vehicle.classList.add('counted');

      const badge = vehicle.querySelector('.count-badge');
      const currentCount = countedVehicles.size;
      badge.textContent = currentCount;
      badge.style.display = 'flex';

      speakNumber(currentCount);

      updateCounter();

      if (countedVehicles.size === totalVehicles) {
        setTimeout(showCompletion, 800);
      }
    }

    function speakNumber(num) {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(num.toString());
        utterance.lang = 'en-US';
        utterance.rate = 0.8;
        utterance.pitch = 1.2;
        utterance.volume = 0.9;
        speechSynthesis.cancel();
        speechSynthesis.speak(utterance);
      }
    }

    function updateCounter() {
      const counter = document.getElementById('counter');
      if (counter) {
        counter.innerHTML = `<span class="text-4xl md:text-5xl">${countedVehicles.size}</span> / ${totalVehicles}`;
      }
    }

    function showCompletion() {
      const modal = document.getElementById('completion-modal');
      const message = config.completion_message.replace('{count}', totalVehicles);
      modal.querySelector('p').textContent = message;
      modal.style.background = `linear-gradient(135deg, ${config.completion_bg_color}, ${config.completion_bg_color}cc)`;
      modal.classList.remove('hidden');
      speakNumber(totalVehicles);
    }

    function resetGame() {
      countedVehicles.clear();
      totalVehicles = Math.floor(Math.random() * 7) + 4;
      document.getElementById('completion-modal').classList.add('hidden');
      speechSynthesis.cancel();
      renderGame();
    }

    renderGame();
  </script>
</body>
</html>

<!doctype html>
<html lang="en" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Count the Cars & Trucks!</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { margin:0; height:100vh; width:100vw; }

.game-background {
  background: linear-gradient(135deg,#87CEEB,#B8E6F2,#D4F4DD,#F0F8D4);
  height:100%;
}

/* ---------- PLAY AREA ---------- */
.play-area {
  border:10px dashed white;
  border-radius:2rem;
  height:100%;
  position:relative;
  overflow:hidden;
  background:rgba(255,255,255,0.1);
}

/* ---------- VEHICLE ---------- */
.vehicle {
  position:absolute;
  width:200px;
  height:120px;
  cursor:pointer;
  filter: drop-shadow(0 6px 14px rgba(0,0,0,0.3));
}

.vehicle-inner {
  width:100%;
  height:100%;
  animation: float 4s ease-in-out infinite alternate;
  transition: transform 0.25s ease;
}

.vehicle:hover .vehicle-inner {
  transform: scale(1.12);
}

.vehicle.counted {
  pointer-events:none;
  opacity:0.5;
}

.vehicle.counted .vehicle-inner {
  animation:none;
}

/* Float without layout shift */
@keyframes float {
  from { transform: translateY(0); }
  to   { transform: translateY(-8px); }
}

/* ---------- BADGE ---------- */
.count-badge {
  position:absolute;
  top:-30px;
  right:-30px;
  width:70px;
  height:70px;
  border-radius:50%;
  background:white;
  font-size:2.5rem;
  font-weight:bold;
  display:none;
  align-items:center;
  justify-content:center;
  border:6px solid #FBBF24;
  box-shadow:0 8px 20px rgba(0,0,0,0.3);
}

/* ---------- MODAL ---------- */
#completion-modal {
  background:rgba(0,0,0,0.45);
}
</style>
</head>

<body class="game-background flex flex-col">

<header class="text-center py-6">
  <h1 id="title" class="text-5xl md:text-7xl font-black text-white drop-shadow-xl">
    Count the cars & trucks!
  </h1>

  <div id="counter-header" class="text-3xl md:text-5xl text-yellow-300 font-bold mt-4"></div>

  <button id="langToggle"
    class="mt-6 bg-white/30 hover:bg-white/50 px-8 py-3 rounded-full text-2xl font-bold text-white">
    üåø Te Reo MƒÅori
  </button>
</header>

<main class="flex-1 px-4 pb-4">
  <div class="play-area">
    <div id="vehicles-container" class="absolute inset-0"></div>
  </div>
</main>

<!-- COMPLETION MODAL -->
<div id="completion-modal" class="fixed inset-0 hidden flex items-center justify-center z-50">
  <div class="bg-gradient-to-br from-green-500 to-emerald-600 px-12 py-16 rounded-3xl text-white text-center shadow-2xl border-8 border-white/40">
    <p id="doneTitle" class="text-5xl font-black mb-8">Awesome!</p>
    <p id="completion-text" class="text-4xl mb-12"></p>
    <button id="restart"
      class="bg-white/30 hover:bg-white/50 px-12 py-6 rounded-full text-4xl font-black">
      Next ‚ñ∂
    </button>
  </div>
</div>

<script>
/* ---------- LANGUAGE ---------- */
let language = "en";

const reoNumbers = {
  1:"tahi",2:"rua",3:"toru",4:"whƒÅ",5:"rima",
  6:"ono",7:"whitu",8:"waru",9:"iwa",10:"tekau"
};

function speak(text){
  speechSynthesis.cancel();
  speechSynthesis.speak(new SpeechSynthesisUtterance(text));
}

function speakNumber(n){
  speak(language === "mi" ? reoNumbers[n] : n.toString());
}

/* ---------- GAME ---------- */
let countedVehicles = new Set();
let totalVehicles = Math.floor(Math.random()*6)+3;

const colors = ['#FF6B6B','#FFD93D','#6BCF7F','#4ECDC4','#54A0FF','#FF9FF3'];

document.getElementById("counter-header").textContent = `0 / ${totalVehicles}`;

function boxesOverlap(a,b,margin=20){
  return !(
    a.x + a.w + margin < b.x ||
    a.x > b.x + b.w + margin ||
    a.y + a.h + margin < b.y ||
    a.y > b.y + b.h + margin
  );
}

function createVehicles(){
  const container = document.getElementById("vehicles-container");
  container.innerHTML="";
  countedVehicles.clear();

  const bounds = container.getBoundingClientRect();
  const W=200, H=120;
  const placed=[];

  for(let i=0;i<totalVehicles;i++){
    let box,tries=0;
    do{
      box={
        x:Math.random()*(bounds.width-W),
        y:Math.random()*(bounds.height-H),
        w:W,
        h:H
      };
      tries++;
    } while(placed.some(p=>boxesOverlap(p,box)) && tries<1000);

    placed.push(box);

    const v=document.createElement("div");
    v.className="vehicle";
    v.style.left=box.x+"px";
    v.style.top=box.y+"px";

    const c=[...colors].sort(()=>Math.random()-0.5);

    v.innerHTML=`
      <div class="vehicle-inner">
        <svg width="200" height="120" viewBox="0 0 100 60">
          <rect x="10" y="25" width="80" height="20" rx="8" fill="${c[0]}"/>
          <circle cx="25" cy="50" r="10" fill="#333"/>
          <circle cx="75" cy="50" r="10" fill="#333"/>
        </svg>
      </div>
      <div class="count-badge"></div>
    `;

    v.onclick=()=>{
      if(countedVehicles.has(i)) return;
      countedVehicles.add(i);
      v.classList.add("counted");

      const badge=v.querySelector(".count-badge");
      badge.textContent=countedVehicles.size;
      badge.style.display="flex";

      document.getElementById("counter-header").textContent=
        `${countedVehicles.size} / ${totalVehicles}`;

      speakNumber(countedVehicles.size);

      if(countedVehicles.size===totalVehicles){
        setTimeout(()=>{
          document.getElementById("completion-text").textContent =
            language==="mi"
              ? `E ${reoNumbers[totalVehicles]} ngƒÅ waka katoa!`
              : `There are ${totalVehicles} vehicles!`;

          document.getElementById("completion-modal").classList.remove("hidden");
          speakNumber(totalVehicles);
        },700);
      }
    };

    container.appendChild(v);
  }
}

/* ---------- CONTROLS ---------- */
document.getElementById("restart").onclick=()=>{
  totalVehicles=Math.floor(Math.random()*6)+3;
  document.getElementById("counter-header").textContent=`0 / ${totalVehicles}`;
  document.getElementById("completion-modal").classList.add("hidden");
  createVehicles();
};

document.getElementById("langToggle").onclick=()=>{
  language = language==="en" ? "mi" : "en";
  document.getElementById("title").textContent =
    language==="mi" ? "Tatauhia ngƒÅ waka!" : "Count the cars & trucks!";
  document.getElementById("doneTitle").textContent =
    language==="mi" ? "Ka pai!" : "Awesome!";
  document.getElementById("langToggle").textContent =
    language==="mi" ? "üá¨üáß English" : "üåø Te Reo MƒÅori";
};

createVehicles();
</script>

</body>
</html>

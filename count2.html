<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Count the Butterflies</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
html, body {
  margin: 0;
  height: 100%;
  overflow: hidden;
}

body {
  background: linear-gradient(135deg, #a8e6cf, #dcedc1, #ffe0b5);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

.butterfly svg {
  width: clamp(80px, 18vw, 140px);
  height: auto;
  transition: transform 0.3s ease;
}

.butterfly:hover svg {
  transform: scale(1.15) rotate(8deg);
}

.butterfly.counted {
  opacity: 0.4;
  pointer-events: none;
}

.count-badge {
  position: absolute;
  top: -10px;
  right: -10px;
  width: 48px;
  height: 48px;
  background: white;
  border-radius: 999px;
  display: none;
  align-items: center;
  justify-content: center;
  font-weight: 900;
  font-size: 1.25rem;
  box-shadow: 0 6px 16px rgba(0,0,0,0.25);
}

#completion {
  animation: drop 0.4s ease-out;
}

@keyframes drop {
  from { transform: translate(-50%, -30px); opacity: 0; }
  to   { transform: translate(-50%, 0); opacity: 1; }
}
</style>
</head>

<body>
<div class="h-full flex flex-col px-4 pt-4">

  <!-- Header -->
  <div class="flex items-center justify-between mb-3">
    <h1 class="text-3xl md:text-4xl font-black">Count the butterflies!</h1>
    <div id="counter" class="text-2xl md:text-3xl font-black bg-white px-5 py-2 rounded-full shadow">
      0 / 0
    </div>
  </div>

  <!-- Play Area -->
  <div id="play-area" class="flex-1 grid place-items-center overflow-hidden">
    <div id="grid" class="grid gap-6 w-full h-full place-items-center"></div>
  </div>
</div>

<!-- Completion -->
<div id="completion" class="hidden fixed top-6 left-1/2 bg-emerald-500 text-white px-10 py-6 rounded-3xl shadow-2xl text-center">
  <p id="completion-text" class="text-2xl md:text-3xl font-black mb-4"></p>
  <button onclick="resetGame()" class="bg-white/20 px-8 py-3 rounded-full font-black hover:bg-white/30">
    Play again
  </button>
</div>

<script>
let total = Math.floor(Math.random()*7)+4;
let counted = new Set();

const colors = [
  "#FF6B6B","#FFD93D","#6BCF7F","#4ECDC4",
  "#54A0FF","#FF9FF3","#FECA57","#A0E7E5"
];

function speak(n){
  if(!("speechSynthesis" in window)) return;
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(n.toString());
  u.rate=0.85;
  u.pitch=1.2;
  speechSynthesis.speak(u);
}

function calculateFit(){
  const area=document.getElementById("play-area").getBoundingClientRect();
  const size=Math.min(Math.max(window.innerWidth*0.18,80),140);
  const cols=Math.floor(area.width/(size+24));
  const rows=Math.floor(area.height/(size+24));
  return Math.max(1,cols*rows);
}

function render(){
  counted.clear();
  const grid=document.getElementById("grid");
  grid.innerHTML="";

  const maxFit=calculateFit();
  total=Math.min(total,maxFit);

  document.getElementById("counter").textContent=`0 / ${total}`;

  const cols=Math.ceil(Math.sqrt(total));
  grid.style.gridTemplateColumns=`repeat(${cols},1fr)`;

  for(let i=0;i<total;i++){
    const b=document.createElement("div");
    b.className="butterfly relative cursor-pointer";

    const c=[...colors].sort(()=>Math.random()-0.5);

    b.innerHTML=`
      <svg viewBox="0 0 100 100">
        <path d="M50 50 Q20 10 10 30 Q5 50 20 60 Q35 75 50 50Z" fill="${c[0]}"/>
        <path d="M50 50 Q20 90 10 70 Q5 50 20 40 Q35 25 50 50Z" fill="${c[1]}"/>
        <path d="M50 50 Q80 10 90 30 Q95 50 80 60 Q65 75 50 50Z" fill="${c[2]}"/>
        <path d="M50 50 Q80 90 90 70 Q95 50 80 40 Q65 25 50 50Z" fill="${c[3]||c[0]}"/>
        <ellipse cx="50" cy="50" rx="4" ry="18" fill="#2D3436"/>
      </svg>
      <div class="count-badge"></div>
    `;

    b.onclick=()=>{
      if(counted.has(i)) return;
      counted.add(i);
      b.classList.add("counted");

      const badge=b.querySelector(".count-badge");
      badge.textContent=counted.size;
      badge.style.display="flex";

      document.getElementById("counter").textContent=
        `${counted.size} / ${total}`;

      speak(counted.size);

      if(counted.size===total){
        setTimeout(()=>{
          document.getElementById("completion-text").textContent=
            `Great job! There are ${total} butterflies!`;
          document.getElementById("completion").classList.remove("hidden");
          speak(total);
        },600);
      }
    };

    grid.appendChild(b);
  }
}

function resetGame(){
  document.getElementById("completion").classList.add("hidden");
  total=Math.floor(Math.random()*7)+4;
  render();
}

window.addEventListener("resize",render);
render();
</script>
</body>
</html>

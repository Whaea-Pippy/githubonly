<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Formulae Builder</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
    font-family: Arial, sans-serif;
    background: #f0f8ff;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}
header {
    background: #333;
    padding: 10px;
    text-align: center;
    color: white;
    position: relative;
}
h1 { font-size: 22px; margin: 5px 0; }
.score-display {
    position: absolute;
    top: 10px;
    right: 20px;
    background: rgba(255,255,255,0.9);
    color: #333;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 18px;
}
.nav-buttons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    padding: 8px 0;
}
.nav-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    font-size: 24px;
    font-weight: bold;
    color: white;
    cursor: pointer;
}
.nav-btn.active {
    box-shadow: 0 0 15px 4px rgba(255,255,255,0.8);
    transform: scale(1.15);
}
main {
    flex: 1;
    padding: 20px;
    display: flex;
}
.formula-container {
    flex: 1;
    background: white;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
.prompt {
    font-size: 32px;
    font-weight: bold;
    margin-bottom: 30px;
    text-align: center;
}
.formula-area {
    background: #f8f8f8;
    border: 3px dashed #ddd;
    border-radius: 20px;
    min-height: 140px;
    width: 100%;
    max-width: 900px;
    padding: 20px;
    margin-bottom: 30px;
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    font-size: 40px;
    font-weight: bold;
}
.formula-area.empty::before {
    content: "Drag or click symbols here to build the formula...";
    color: #aaa;
    font-style: italic;
    font-size: 28px;
}
.symbol-bank {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px,1fr));
    gap: 15px;
    max-width: 900px;
    width: 100%;
    margin-bottom: 30px;
}
.symbol {
    background: var(--level-color);
    color: white;
    width: 80px;
    height: 80px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    font-weight: bold;
    cursor: pointer;
}
.symbol.used {
    opacity: 0.4;
    pointer-events: none;
}
.placed-symbol {
    background: var(--level-color);
    color: white;
    padding: 14px 28px;
    border-radius: 20px;
    font-size: 40px;
    cursor: pointer;
}
.check-btn {
    background: #4CAF50;
    color: white;
    padding: 14px 40px;
    border: none;
    border-radius: 30px;
    font-size: 20px;
    cursor: pointer;
}
.feedback {
    margin-top: 25px;
    font-size: 34px;
    font-weight: bold;
    min-height: 50px;
}
</style>
</head>
<body>
<header>
<h1>Math Formulae Builder</h1>
<div class="score-display" id="score-display">Score: 0/0</div>
<div class="nav-buttons">
<button class="nav-btn active" style="background:#FF6B6B" data-level="1">1</button>
<button class="nav-btn" style="background:#FF8E53" data-level="2">2</button>
<button class="nav-btn" style="background:#FFCC00" data-level="3">3</button>
<button class="nav-btn" style="background:#9ACD32" data-level="4">4</button>
<button class="nav-btn" style="background:#4CAF50" data-level="5">5</button>
<button class="nav-btn" style="background:#20B2AA" data-level="6">6</button>
<button class="nav-btn" style="background:#4682B4" data-level="7">7</button>
<button class="nav-btn" style="background:#9370DB" data-level="8">8</button>
<button class="nav-btn" style="background:#DA70D6" data-level="9">9</button>
<button class="nav-btn" style="background:#FF69B4" data-level="10">10</button>
</div>
</header>
<main>
<div class="formula-container">
<div class="prompt" id="prompt"></div>
<div class="formula-area empty" id="formula-area"></div>
<div class="symbol-bank" id="symbol-bank"></div>
<button class="check-btn" id="check-btn">Check Formula âœ“</button>
<div class="feedback" id="feedback"></div>
</div>
</main>
<script>
const STORAGE_KEY = 'grokmath_scores';
const ACTIVITY_NAME = 'formulaebuilder';

let scores = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
if (!scores[ACTIVITY_NAME]) scores[ACTIVITY_NAME] = { correct: 0, total: 0 };
localStorage.setItem(STORAGE_KEY, JSON.stringify(scores));

function updateScoreDisplay() {
    const s = scores[ACTIVITY_NAME];
    document.getElementById('score-display').textContent = `Score: ${s.correct}/${s.total}`;
}

const colors = ['#FF6B6B','#FF8E53','#FFCC00','#9ACD32','#4CAF50','#20B2AA','#4682B4','#9370DB','#DA70D6','#FF69B4'];

const formulae = [
    [], // unused
    [ // Level 1
        {prompt: "Area of a rectangle", symbols: ["A", "=", "l", "Ã—", "w"], correctOptions: [["A", "=", "l", "Ã—", "w"], ["A", "=", "w", "Ã—", "l"]]},
        {prompt: "Perimeter of a rectangle", symbols: ["P", "=", "2", "(", "l", "+", "w", ")"], correctOptions: [["P", "=", "2", "(", "l", "+", "w", ")"]]},
        {prompt: "Area of a triangle", symbols: ["A", "=", "1/2", "b", "Ã—", "h"], correctOptions: [["A", "=", "1/2", "b", "Ã—", "h"], ["A", "=", "1/2", "h", "Ã—", "b"]]},
        {prompt: "Circumference of a circle", symbols: ["C", "=", "2", "Ï€", "r"], correctOptions: [["C", "=", "2", "Ï€", "r"]]},
        {prompt: "Area of a circle", symbols: ["A", "=", "Ï€", "r", "Â²"], correctOptions: [["A", "=", "Ï€", "r", "Â²"]]}
    ],
    [ // Level 2
        {prompt: "Volume of a cuboid", symbols: ["V", "=", "l", "Ã—", "w", "Ã—", "h"], correctOptions: [["V", "=", "l", "Ã—", "w", "Ã—", "h"], ["V", "=", "l", "Ã—", "h", "Ã—", "w"], ["V", "=", "w", "Ã—", "l", "Ã—", "h"], ["V", "=", "w", "Ã—", "h", "Ã—", "l"], ["V", "=", "h", "Ã—", "l", "Ã—", "w"], ["V", "=", "h", "Ã—", "w", "Ã—", "l"]]},
        {prompt: "Volume of a cylinder", symbols: ["V", "=", "Ï€", "r", "Â²", "h"], correctOptions: [["V", "=", "Ï€", "r", "Â²", "h"]]},
        {prompt: "Speed", symbols: ["s", "=", "d", "Ã·", "t"], correctOptions: [["s", "=", "d", "Ã·", "t"]]},
        {prompt: "Density", symbols: ["Ï", "=", "m", "Ã·", "V"], correctOptions: [["Ï", "=", "m", "Ã·", "V"]]},
        {prompt: "Simple interest", symbols: ["I", "=", "P", "Ã—", "r", "Ã—", "t"], correctOptions: [["I", "=", "P", "Ã—", "r", "Ã—", "t"]]}
    ],
    [ // Level 3
        {prompt: "Pythagorean theorem", symbols: ["c", "Â²", "=", "a", "Â²", "+", "b", "Â²"], correctOptions: [["c", "Â²", "=", "a", "Â²", "+", "b", "Â²"], ["c", "Â²", "=", "b", "Â²", "+", "a", "Â²"]]},
        {prompt: "Quadratic formula", symbols: ["x", "=", "âˆ’b", "Â±", "âˆš", "(", "b", "Â²", "âˆ’", "4ac", ")", "Ã·", "2a"], correctOptions: [["x", "=", "âˆ’b", "Â±", "âˆš", "(", "b", "Â²", "âˆ’", "4ac", ")", "Ã·", "2a"]]},
        {prompt: "Slope of a line", symbols: ["m", "=", "(", "yâ‚‚", "âˆ’", "yâ‚", ")", "Ã·", "(", "xâ‚‚", "âˆ’", "xâ‚", ")"], correctOptions: [["m", "=", "(", "yâ‚‚", "âˆ’", "yâ‚", ")", "Ã·", "(", "xâ‚‚", "âˆ’", "xâ‚", ")"]]},
        {prompt: "Distance formula", symbols: ["d", "=", "âˆš", "(", "(", "xâ‚‚", "âˆ’", "xâ‚", ")", "Â²", "+", "(", "yâ‚‚", "âˆ’", "yâ‚", ")", "Â²", ")"], correctOptions: [["d", "=", "âˆš", "(", "(", "xâ‚‚", "âˆ’", "xâ‚", ")", "Â²", "+", "(", "yâ‚‚", "âˆ’", "yâ‚", ")", "Â²", ")"]]},
        {prompt: "Mean", symbols: ["xÌ„", "=", "Î£x", "Ã·", "n"], correctOptions: [["xÌ„", "=", "Î£x", "Ã·", "n"]]}
    ],
    [ // Level 4
        {prompt: "Sine ratio", symbols: ["sin", "Î¸", "=", "opposite", "Ã·", "hypotenuse"], correctOptions: [["sin", "Î¸", "=", "opposite", "Ã·", "hypotenuse"]]},
        {prompt: "Cosine ratio", symbols: ["cos", "Î¸", "=", "adjacent", "Ã·", "hypotenuse"], correctOptions: [["cos", "Î¸", "=", "adjacent", "Ã·", "hypotenuse"]]},
        {prompt: "Tangent ratio", symbols: ["tan", "Î¸", "=", "opposite", "Ã·", "adjacent"], correctOptions: [["tan", "Î¸", "=", "opposite", "Ã·", "adjacent"]]},
        {prompt: "Area of trapezium", symbols: ["A", "=", "1/2", "(", "a", "+", "b", ")", "h"], correctOptions: [["A", "=", "1/2", "(", "a", "+", "b", ")", "h"], ["A", "=", "1/2", "(", "b", "+", "a", ")", "h"]]},
        {prompt: "Surface area of cuboid", symbols: ["SA", "=", "2", "(", "lw", "+", "lh", "+", "wh", ")"], correctOptions: [["SA", "=", "2", "(", "lw", "+", "lh", "+", "wh", ")"]]}
    ],
    [ // Level 5
        {prompt: "Volume of sphere", symbols: ["V", "=", "4/3", "Ï€", "r", "Â³"], correctOptions: [["V", "=", "4/3", "Ï€", "r", "Â³"]]},
        {prompt: "Surface area of sphere", symbols: ["SA", "=", "4", "Ï€", "r", "Â²"], correctOptions: [["SA", "=", "4", "Ï€", "r", "Â²"]]},
        {prompt: "Volume of cone", symbols: ["V", "=", "1/3", "Ï€", "r", "Â²", "h"], correctOptions: [["V", "=", "1/3", "Ï€", "r", "Â²", "h"]]},
        {prompt: "Surface area of cylinder", symbols: ["SA", "=", "2", "Ï€", "r", "h", "+", "2", "Ï€", "r", "Â²"], correctOptions: [["SA", "=", "2", "Ï€", "r", "h", "+", "2", "Ï€", "r", "Â²"]]},
        {prompt: "Area of parallelogram", symbols: ["A", "=", "b", "Ã—", "h"], correctOptions: [["A", "=", "b", "Ã—", "h"]]}
    ],
    [ // Level 6
        {prompt: "Time formula", symbols: ["t", "=", "d", "Ã·", "s"], correctOptions: [["t", "=", "d", "Ã·", "s"]]},
        {prompt: "Work rate", symbols: ["work", "=", "rate", "Ã—", "time"], correctOptions: [["work", "=", "rate", "Ã—", "time"]]},
        {prompt: "Direct proportion", symbols: ["y", "=", "k", "x"], correctOptions: [["y", "=", "k", "x"]]},
        {prompt: "Inverse proportion", symbols: ["y", "=", "k", "Ã·", "x"], correctOptions: [["y", "=", "k", "Ã·", "x"]]},
        {prompt: "Compound interest", symbols: ["A", "=", "P", "(", "1", "+", "r", ")", "^", "t"], correctOptions: [["A", "=", "P", "(", "1", "+", "r", ")", "^", "t"]]}
    ],
    [ // Level 7
        {prompt: "Standard deviation (population)", symbols: ["Ïƒ", "=", "âˆš", "(", "Î£", "(", "x", "âˆ’", "Î¼", ")", "Â²", "Ã·", "N", ")"], correctOptions: [["Ïƒ", "=", "âˆš", "(", "Î£", "(", "x", "âˆ’", "Î¼", ")", "Â²", "Ã·", "N", ")"]]},
        {prompt: "Probability", symbols: ["P", "(", "A", ")", "=", "n(A)", "Ã·", "n(S)"], correctOptions: [["P", "(", "A", ")", "=", "n(A)", "Ã·", "n(S)"]]},
        {prompt: "Variance", symbols: ["Ïƒ", "Â²", "=", "Î£", "(", "x", "âˆ’", "Î¼", ")", "Â²", "Ã·", "N"], correctOptions: [["Ïƒ", "Â²", "=", "Î£", "(", "x", "âˆ’", "Î¼", ")", "Â²", "Ã·", "N"]]},
        {prompt: "Median", symbols: ["median", "=", "middle", "value"], correctOptions: [["median", "=", "middle", "value"]]},
        {prompt: "Mode", symbols: ["mode", "=", "most", "frequent"], correctOptions: [["mode", "=", "most", "frequent"]]}
    ],
    [ // Level 8
        {prompt: "Discriminant", symbols: ["Î”", "=", "b", "Â²", "âˆ’", "4ac"], correctOptions: [["Î”", "=", "b", "Â²", "âˆ’", "4ac"]]},
        {prompt: "Sum of arithmetic series", symbols: ["S_n", "=", "n/2", "(", "2a", "+", "(", "n", "âˆ’", "1", ")", "d", ")"], correctOptions: [["S_n", "=", "n/2", "(", "2a", "+", "(", "n", "âˆ’", "1", ")", "d", ")"]]},
        {prompt: "Sum of geometric series", symbols: ["S_n", "=", "a", "(", "1", "âˆ’", "r", "n", ")", "Ã·", "(", "1", "âˆ’", "r", ")"], correctOptions: [["S_n", "=", "a", "(", "1", "âˆ’", "r", "n", ")", "Ã·", "(", "1", "âˆ’", "r", ")"]]},
        {prompt: "Factor theorem", symbols: ["(x", "âˆ’", "a", ")", "factor", "if", "f(a)", "=", "0"], correctOptions: [["(x", "âˆ’", "a", ")", "factor", "if", "f(a)", "=", "0"]]},
        {prompt: "Binomial theorem", symbols: ["(a", "+", "b)", "n", "=", "Î£", "C(n,k)", "a", "^(n-k)", "b", "^k"], correctOptions: [["(a", "+", "b)", "n", "=", "Î£", "C(n,k)", "a", "^(n-k)", "b", "^k"]]}
    ],
    [ // Level 9
        {prompt: "Midpoint formula", symbols: ["M", "=", "(", "(", "xâ‚", "+", "xâ‚‚", ")", "Ã·", "2", ",", "(", "yâ‚", "+", "yâ‚‚", ")", "Ã·", "2", ")"], correctOptions: [["M", "=", "(", "(", "xâ‚", "+", "xâ‚‚", ")", "Ã·", "2", ",", "(", "yâ‚", "+", "yâ‚‚", ")", "Ã·", "2", ")"]]},
        {prompt: "Equation of line (slope-intercept)", symbols: ["y", "=", "m", "x", "+", "c"], correctOptions: [["y", "=", "m", "x", "+", "c"]]},
        {prompt: "Equation of circle", symbols: ["(x", "âˆ’", "h)", "Â²", "+", "(y", "âˆ’", "k)", "Â²", "=", "r", "Â²"], correctOptions: [["(x", "âˆ’", "h)", "Â²", "+", "(y", "âˆ’", "k)", "Â²", "=", "r", "Â²"]]},
        {prompt: "Section formula", symbols: ["(", "m", "xâ‚‚", "+", "n", "xâ‚", "Ã·", "(m+n)", ",", "m", "yâ‚‚", "+", "n", "yâ‚", "Ã·", "(m+n)", ")"], correctOptions: [["(", "m", "xâ‚‚", "+", "n", "xâ‚", "Ã·", "(m+n)", ",", "m", "yâ‚‚", "+", "n", "yâ‚", "Ã·", "(m+n)", ")"]]},
        {prompt: "Perpendicular lines", symbols: ["mâ‚", "Ã—", "mâ‚‚", "=", "âˆ’1"], correctOptions: [["mâ‚", "Ã—", "mâ‚‚", "=", "âˆ’1"]]}
    ],
    [ // Level 10
        {prompt: "Law of cosines", symbols: ["c", "Â²", "=", "a", "Â²", "+", "b", "Â²", "âˆ’", "2ab", "cosC"], correctOptions: [["c", "Â²", "=", "a", "Â²", "+", "b", "Â²", "âˆ’", "2ab", "cosC"]]},
        {prompt: "Law of sines", symbols: ["a", "Ã·", "sinA", "=", "b", "Ã·", "sinB", "=", "c", "Ã·", "sinC"], correctOptions: [["a", "Ã·", "sinA", "=", "b", "Ã·", "sinB", "=", "c", "Ã·", "sinC"]]},
        {prompt: "Euler's formula", symbols: ["e", "iÏ€", "+", "1", "=", "0"], correctOptions: [["e", "iÏ€", "+", "1", "=", "0"]]},
        {prompt: "Surface area of cone", symbols: ["SA", "=", "Ï€", "r", "l", "+", "Ï€", "r", "Â²"], correctOptions: [["SA", "=", "Ï€", "r", "l", "+", "Ï€", "r", "Â²"]]},
        {prompt: "Volume of pyramid", symbols: ["V", "=", "1/3", "B", "h"], correctOptions: [["V", "=", "1/3", "B", "h"]]}
    ]
];

let currentLevel = 1;
let currentFormulaIndex = 0;

const promptEl = document.getElementById("prompt");
const formulaArea = document.getElementById("formula-area");
const bank = document.getElementById("symbol-bank");
const feedback = document.getElementById("feedback");
const checkBtn = document.getElementById("check-btn");
const scoreEl = document.getElementById("score-display");

function load() {
    const f = formulae[currentLevel][currentFormulaIndex];
    promptEl.textContent = "Build the formula for: " + f.prompt;
    formulaArea.innerHTML = "";
    formulaArea.classList.add("empty");
    bank.innerHTML = "";
    feedback.textContent = "";
    checkBtn.disabled = false;
    const col = colors[currentLevel-1];
    document.body.style.backgroundColor = col + '22';
    shuffle(f.symbols).forEach(s=>{
        const d=document.createElement("div");
        d.className="symbol";
        d.textContent=s;
        d.style.setProperty("--level-color",col);
        d.onclick=()=>{
            if(d.classList.contains("used"))return;
            d.classList.add("used");
            place(s,col);
        };
        bank.appendChild(d);
    });
    document.querySelectorAll(".nav-btn").forEach(b=>{
        b.classList.toggle("active",Number(b.dataset.level)===currentLevel);
    });
}

function place(s,col){
    const d=document.createElement("div");
    d.className="placed-symbol";
    d.textContent=s;
    d.style.setProperty("--level-color",col);
    d.onclick=()=>{
        d.remove();
        [...bank.children].find(b=>b.textContent===s && b.classList.contains("used"))?.classList.remove("used");
        if(!formulaArea.children.length) formulaArea.classList.add("empty");
    };
    formulaArea.appendChild(d);
    formulaArea.classList.remove("empty");
}

checkBtn.onclick=()=>{
    const built=[...formulaArea.children].map(e=>e.textContent);
    const f=formulae[currentLevel][currentFormulaIndex];
    scores[ACTIVITY_NAME].total++;
    const correct=f.correctOptions.some(o=>o.length===built.length && o.every((v,i)=>v===built[i]));
    if(correct){
        feedback.textContent="ðŸŽ‰ Perfect formula!";
        feedback.style.color="#4CAF50";
        scores[ACTIVITY_NAME].correct++;
        checkBtn.disabled=true;
        setTimeout(()=>{
            currentFormulaIndex++;
            if(currentFormulaIndex>=formulae[currentLevel].length) currentFormulaIndex=0;
            load();
        },1500);
    } else {
        feedback.textContent="âŒ Not quite â€“ try again!";
        feedback.style.color="#FF6B6B";
    }
    updateScoreDisplay();
};

document.querySelectorAll(".nav-btn").forEach(b=>{
    b.onclick=()=>{
        currentLevel=Number(b.dataset.level);
        currentFormulaIndex=0;
        load();
    };
});

function shuffle(a){ return a.slice().sort(()=>Math.random()-0.5); }

function updateScoreDisplay() {
    const s = scores[ACTIVITY_NAME];
    scoreEl.textContent = `Score: ${s.correct}/${s.total}`;
}

updateScoreDisplay();
load();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Formulae Builder</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: Arial, sans-serif;
            background: #f0f8ff;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        header {
            background: #333;
            padding: 10px;
            text-align: center;
            color: white;
            position: relative;
        }
        h1 { font-size: 22px; margin: 5px 0; }
        .score-display {
            position: absolute;
            top: 10px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 10;
        }
        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            padding: 8px 0;
        }
        .nav-btn {
            width: 60px; height: 60px; border-radius: 50%; border: none;
            font-size: 24px; font-weight: bold; color: white; cursor: pointer;
            transition: all 0.2s;
        }
        .nav-btn:hover { transform: scale(1.1); }
        .nav-btn.active { box-shadow: 0 0 15px 4px rgba(255,255,255,0.8); transform: scale(1.15); }

        main { flex: 1; padding: 20px 15px 15px; overflow: hidden; display: flex; flex-direction: column; }
        .formula-container {
            flex: 1;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .prompt {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
            color: #333;
        }
        .formula-area {
            background: #f8f8f8;
            border: 3px dashed #ddd;
            border-radius: 20px;
            min-height: 140px;
            width: 100%;
            max-width: 900px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 40px;
            font-weight: bold;
            color: #333;
        }
        .formula-area.empty::before {
            content: "Drag or click symbols here to build the formula...";
            color: #aaa;
            font-style: italic;
            font-size: 28px;
            font-weight: normal;
        }
        .symbol-bank {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
            width: 100%;
            max-width: 900px;
            margin-bottom: 30px;
        }
        .symbol {
            background: var(--level-color);
            color: white;
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            cursor: grab;
            user-select: none;
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        .symbol:active { cursor: grabbing; transform: scale(0.95); }
        .symbol.used { opacity: 0.4; cursor: not-allowed; }
        .placed-symbol {
            background: var(--level-color);
            color: white;
            padding: 14px 28px;
            border-radius: 20px;
            font-size: 40px;
            cursor: pointer;
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
        .placed-symbol:hover { transform: translateY(-4px); }
        .buttons {
            display: flex;
            gap: 20px;
        }
        .check-btn {
            background: #4CAF50;
            color: white;
            padding: 14px 40px;
            border: none;
            border-radius: 30px;
            font-size: 20px;
            cursor: pointer;
        }
        .check-btn:hover { background: #45a049; }
        .feedback {
            margin-top: 30px;
            font-size: 32px;
            font-weight: bold;
            min-height: 50px;
        }
        footer {
            background: #333;
            padding: 15px;
            text-align: center;
        }
        .footer-btn {
            background: white; color: #333; border: none;
            padding: 14px 40px; margin: 0 20px; border-radius: 30px;
            font-size: 20px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .footer-btn:hover { background: #eee; }
    </style>
</head>
<body>

<header>
    <h1>Math Formulae Builder</h1>
    <div class="score-display" id="score-display">Score: 0/0</div>
    <div class="nav-buttons">
        <button class="nav-btn active" style="background:#FF6B6B" data-level="1">1</button>
        <button class="nav-btn" style="background:#FF8E53" data-level="2">2</button>
        <button class="nav-btn" style="background:#FFCC00" data-level="3">3</button>
        <button class="nav-btn" style="background:#9ACD32" data-level="4">4</button>
        <button class="nav-btn" style="background:#4CAF50" data-level="5">5</button>
        <button class="nav-btn" style="background:#20B2AA" data-level="6">6</button>
        <button class="nav-btn" style="background:#4682B4" data-level="7">7</button>
        <button class="nav-btn" style="background:#9370DB" data-level="8">8</button>
        <button class="nav-btn" style="background:#DA70D6" data-level="9">9</button>
        <button class="nav-btn" style="background:#FF69B4" data-level="10">10</button>
    </div>
</header>

<main>
    <div class="formula-container">
        <div class="prompt" id="prompt"></div>
        <div class="formula-area" id="formula-area"></div>
        <div class="symbol-bank" id="symbol-bank"></div>
        <div class="buttons">
            <button class="check-btn" id="check-btn">Check Formula ✓</button>
        </div>
        <div class="feedback" id="feedback"></div>
    </div>
</main>

<footer>
    <button class="footer-btn" id="reset-btn">Reset Level</button>
    <button class="footer-btn" id="next-btn" style="display:none;">Next Formula →</button>
</footer>

<script>
    const STORAGE_KEY = 'grokmath_scores';
    const ACTIVITY_NAME = 'formulaebuilder';

    let scores = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
    if (!scores[ACTIVITY_NAME]) scores[ACTIVITY_NAME] = { correct: 0, total: 0 };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(scores));

    function updateScoreDisplay() {
        const s = scores[ACTIVITY_NAME];
        document.getElementById('score-display').textContent = `Score: ${s.correct}/${s.total}`;
    }

    const colors = ['#FF6B6B','#FF8E53','#FFCC00','#9ACD32','#4CAF50','#20B2AA','#4682B4','#9370DB','#DA70D6','#FF69B4'];

    const formulae = [
        [], // unused
        [ // Level 1
            {prompt: "Area of a rectangle", symbols: ["A", "=", "l", "×", "w"], correctOptions: [["A", "=", "l", "×", "w"], ["A", "=", "w", "×", "l"]]},
            {prompt: "Perimeter of a rectangle", symbols: ["P", "=", "2", "(", "l", "+", "w", ")"], correctOptions: [["P", "=", "2", "(", "l", "+", "w", ")"]]},
            {prompt: "Area of a triangle", symbols: ["A", "=", "1/2", "b", "×", "h"], correctOptions: [["A", "=", "1/2", "b", "×", "h"], ["A", "=", "1/2", "h", "×", "b"]]},
            {prompt: "Circumference of a circle", symbols: ["C", "=", "2", "π", "r"], correctOptions: [["C", "=", "2", "π", "r"]]},
            {prompt: "Area of a circle", symbols: ["A", "=", "π", "r", "²"], correctOptions: [["A", "=", "π", "r", "²"]]}
        ],
        [ // Level 2
            {prompt: "Volume of a cuboid", symbols: ["V", "=", "l", "×", "w", "×", "h"], correctOptions: [["V", "=", "l", "×", "w", "×", "h"], ["V", "=", "l", "×", "h", "×", "w"], ["V", "=", "w", "×", "l", "×", "h"], ["V", "=", "w", "×", "h", "×", "l"], ["V", "=", "h", "×", "l", "×", "w"], ["V", "=", "h", "×", "w", "×", "l"]]},
            {prompt: "Volume of a cylinder", symbols: ["V", "=", "π", "r", "²", "h"], correctOptions: [["V", "=", "π", "r", "²", "h"]]},
            {prompt: "Speed", symbols: ["s", "=", "d", "÷", "t"], correctOptions: [["s", "=", "d", "÷", "t"]]},
            {prompt: "Density", symbols: ["ρ", "=", "m", "÷", "V"], correctOptions: [["ρ", "=", "m", "÷", "V"]]},
            {prompt: "Simple interest", symbols: ["I", "=", "P", "×", "r", "×", "t"], correctOptions: [["I", "=", "P", "×", "r", "×", "t"]]}
        ],
        [ // Level 3
            {prompt: "Pythagorean theorem", symbols: ["c", "²", "=", "a", "²", "+", "b", "²"], correctOptions: [["c", "²", "=", "a", "²", "+", "b", "²"], ["c", "²", "=", "b", "²", "+", "a", "²"]]},
            {prompt: "Quadratic formula", symbols: ["x", "=", "−b", "±", "√", "(", "b", "²", "−", "4ac", ")", "÷", "2a"], correctOptions: [["x", "=", "−b", "±", "√", "(", "b", "²", "−", "4ac", ")", "÷", "2a"]]},
            {prompt: "Slope of a line", symbols: ["m", "=", "(", "y₂", "−", "y₁", ")", "÷", "(", "x₂", "−", "x₁", ")"], correctOptions: [["m", "=", "(", "y₂", "−", "y₁", ")", "÷", "(", "x₂", "−", "x₁", ")"]]},
            {prompt: "Distance formula", symbols: ["d", "=", "√", "(", "(", "x₂", "−", "x₁", ")", "²", "+", "(", "y₂", "−", "y₁", ")", "²", ")"], correctOptions: [["d", "=", "√", "(", "(", "x₂", "−", "x₁", ")", "²", "+", "(", "y₂", "−", "y₁", ")", "²", ")"]]},
            {prompt: "Mean", symbols: ["x̄", "=", "Σx", "÷", "n"], correctOptions: [["x̄", "=", "Σx", "÷", "n"]]}
        ],
        [ // Level 4
            {prompt: "Sine ratio", symbols: ["sin", "θ", "=", "opposite", "÷", "hypotenuse"], correctOptions: [["sin", "θ", "=", "opposite", "÷", "hypotenuse"]]},
            {prompt: "Cosine ratio", symbols: ["cos", "θ", "=", "adjacent", "÷", "hypotenuse"], correctOptions: [["cos", "θ", "=", "adjacent", "÷", "hypotenuse"]]},
            {prompt: "Tangent ratio", symbols: ["tan", "θ", "=", "opposite", "÷", "adjacent"], correctOptions: [["tan", "θ", "=", "opposite", "÷", "adjacent"]]},
            {prompt: "Area of trapezium", symbols: ["A", "=", "1/2", "(", "a", "+", "b", ")", "h"], correctOptions: [["A", "=", "1/2", "(", "a", "+", "b", ")", "h"], ["A", "=", "1/2", "(", "b", "+", "a", ")", "h"]]},
            {prompt: "Surface area of cuboid", symbols: ["SA", "=", "2", "(", "lw", "+", "lh", "+", "wh", ")"], correctOptions: [["SA", "=", "2", "(", "lw", "+", "lh", "+", "wh", ")"]]}
        ],
        [ // Level 5
            {prompt: "Volume of sphere", symbols: ["V", "=", "4/3", "π", "r", "³"], correctOptions: [["V", "=", "4/3", "π", "r", "³"]]},
            {prompt: "Surface area of sphere", symbols: ["SA", "=", "4", "π", "r", "²"], correctOptions: [["SA", "=", "4", "π", "r", "²"]]},
            {prompt: "Volume of cone", symbols: ["V", "=", "1/3", "π", "r", "²", "h"], correctOptions: [["V", "=", "1/3", "π", "r", "²", "h"]]},
            {prompt: "Surface area of cylinder", symbols: ["SA", "=", "2", "π", "r", "h", "+", "2", "π", "r", "²"], correctOptions: [["SA", "=", "2", "π", "r", "h", "+", "2", "π", "r", "²"]]},
            {prompt: "Area of parallelogram", symbols: ["A", "=", "b", "×", "h"], correctOptions: [["A", "=", "b", "×", "h"]]}
        ],
        [ // Level 6
            {prompt: "Time formula", symbols: ["t", "=", "d", "÷", "s"], correctOptions: [["t", "=", "d", "÷", "s"]]},
            {prompt: "Work rate", symbols: ["work", "=", "rate", "×", "time"], correctOptions: [["work", "=", "rate", "×", "time"]]},
            {prompt: "Direct proportion", symbols: ["y", "=", "k", "x"], correctOptions: [["y", "=", "k", "x"]]},
            {prompt: "Inverse proportion", symbols: ["y", "=", "k", "÷", "x"], correctOptions: [["y", "=", "k", "÷", "x"]]},
            {prompt: "Compound interest", symbols: ["A", "=", "P", "(", "1", "+", "r", ")", "^", "t"], correctOptions: [["A", "=", "P", "(", "1", "+", "r", ")", "^", "t"]]}
        ],
        [ // Level 7
            {prompt: "Standard deviation (population)", symbols: ["σ", "=", "√", "(", "Σ", "(", "x", "−", "μ", ")", "²", "÷", "N", ")"], correctOptions: [["σ", "=", "√", "(", "Σ", "(", "x", "−", "μ", ")", "²", "÷", "N", ")"]]},
            {prompt: "Probability", symbols: ["P", "(", "A", ")", "=", "n(A)", "÷", "n(S)"], correctOptions: [["P", "(", "A", ")", "=", "n(A)", "÷", "n(S)"]]},
            {prompt: "Variance", symbols: ["σ", "²", "=", "Σ", "(", "x", "−", "μ", ")", "²", "÷", "N"], correctOptions: [["σ", "²", "=", "Σ", "(", "x", "−", "μ", ")", "²", "÷", "N"]]},
            {prompt: "Median", symbols: ["median", "=", "middle", "value"], correctOptions: [["median", "=", "middle", "value"]]},
            {prompt: "Mode", symbols: ["mode", "=", "most", "frequent"], correctOptions: [["mode", "=", "most", "frequent"]]}
        ],
        [ // Level 8
            {prompt: "Discriminant", symbols: ["Δ", "=", "b", "²", "−", "4ac"], correctOptions: [["Δ", "=", "b", "²", "−", "4ac"]]},
            {prompt: "Sum of arithmetic series", symbols: ["S_n", "=", "n/2", "(", "2a", "+", "(", "n", "−", "1", ")", "d", ")"], correctOptions: [["S_n", "=", "n/2", "(", "2a", "+", "(", "n", "−", "1", ")", "d", ")"]]},
            {prompt: "Sum of geometric series", symbols: ["S_n", "=", "a", "(", "1", "−", "r", "n", ")", "÷", "(", "1", "−", "r", ")"], correctOptions: [["S_n", "=", "a", "(", "1", "−", "r", "n", ")", "÷", "(", "1", "−", "r", ")"]]},
            {prompt: "Factor theorem", symbols: ["(x", "−", "a", ")", "factor", "if", "f(a)", "=", "0"], correctOptions: [["(x", "−", "a", ")", "factor", "if", "f(a)", "=", "0"]]},
            {prompt: "Binomial theorem", symbols: ["(a", "+", "b)", "n", "=", "Σ", "C(n,k)", "a", "^(n-k)", "b", "^k"], correctOptions: [["(a", "+", "b)", "n", "=", "Σ", "C(n,k)", "a", "^(n-k)", "b", "^k"]]}
        ],
        [ // Level 9
            {prompt: "Midpoint formula", symbols: ["M", "=", "(", "(", "x₁", "+", "x₂", ")", "÷", "2", ",", "(", "y₁", "+", "y₂", ")", "÷", "2", ")"], correctOptions: [["M", "=", "(", "(", "x₁", "+", "x₂", ")", "÷", "2", ",", "(", "y₁", "+", "y₂", ")", "÷", "2", ")"]]},
            {prompt: "Equation of line (slope-intercept)", symbols: ["y", "=", "m", "x", "+", "c"], correctOptions: [["y", "=", "m", "x", "+", "c"]]},
            {prompt: "Equation of circle", symbols: ["(x", "−", "h)", "²", "+", "(y", "−", "k)", "²", "=", "r", "²"], correctOptions: [["(x", "−", "h)", "²", "+", "(y", "−", "k)", "²", "=", "r", "²"]]},
            {prompt: "Section formula", symbols: ["(", "m", "x₂", "+", "n", "x₁", "÷", "(m+n)", ",", "m", "y₂", "+", "n", "y₁", "÷", "(m+n)", ")"], correctOptions: [["(", "m", "x₂", "+", "n", "x₁", "÷", "(m+n)", ",", "m", "y₂", "+", "n", "y₁", "÷", "(m+n)", ")"]]},
            {prompt: "Perpendicular lines", symbols: ["m₁", "×", "m₂", "=", "−1"], correctOptions: [["m₁", "×", "m₂", "=", "−1"]]}
        ],
        [ // Level 10
            {prompt: "Law of cosines", symbols: ["c", "²", "=", "a", "²", "+", "b", "²", "−", "2ab", "cosC"], correctOptions: [["c", "²", "=", "a", "²", "+", "b", "²", "−", "2ab", "cosC"]]},
            {prompt: "Law of sines", symbols: ["a", "÷", "sinA", "=", "b", "÷", "sinB", "=", "c", "÷", "sinC"], correctOptions: [["a", "÷", "sinA", "=", "b", "÷", "sinB", "=", "c", "÷", "sinC"]]},
            {prompt: "Euler's formula", symbols: ["e", "iπ", "+", "1", "=", "0"], correctOptions: [["e", "iπ", "+", "1", "=", "0"]]},
            {prompt: "Surface area of cone", symbols: ["SA", "=", "π", "r", "l", "+", "π", "r", "²"], correctOptions: [["SA", "=", "π", "r", "l", "+", "π", "r", "²"]]},
            {prompt: "Volume of pyramid", symbols: ["V", "=", "1/3", "B", "h"], correctOptions: [["V", "=", "1/3", "B", "h"]]}
        ]
    ];

    let currentLevel = 1;
    let currentFormulaIndex = 0;
    let draggedSymbol = null;

    const promptEl = document.getElementById('prompt');
    const formulaArea = document.getElementById('formula-area');
    const symbolBank = document.getElementById('symbol-bank');
    const checkBtn = document.getElementById('check-btn');
    const nextBtn = document.getElementById('next-btn');
    const feedbackEl = document.getElementById('feedback');
    const navBtns = document.querySelectorAll('.nav-btn');
    const resetBtn = document.getElementById('reset-btn');

    function loadFormula() {
        const formula = formulae[currentLevel][currentFormulaIndex];
        promptEl.textContent = `Build the formula for: ${formula.prompt}`;

        formulaArea.innerHTML = '';
        formulaArea.classList.add('empty');
        symbolBank.innerHTML = '';

        const color = colors[currentLevel - 1];
        document.body.style.backgroundColor = color + '22';

        const shuffled = shuffle(formula.symbols.slice());

        shuffled.forEach(sym => {
            const symbol = document.createElement('div');
            symbol.className = 'symbol';
            symbol.textContent = sym;
            symbol.style.setProperty('--level-color', color);
            symbol.draggable = true;

            symbol.addEventListener('dragstart', e => {
                draggedSymbol = symbol;
            });

            symbol.addEventListener('click', () => {
                if (!symbol.classList.contains('used')) {
                    placeSymbol(sym, color);
                    symbol.classList.add('used');
                }
            });

            symbolBank.appendChild(symbol);
        });

        updateActiveButton();
    }

    function placeSymbol(sym, color) {
        const placed = document.createElement('div');
        placed.className = 'placed-symbol';
        placed.textContent = sym;
        placed.style.setProperty('--level-color', color);

        placed.addEventListener('click', () => {
            placed.remove();
            const original = Array.from(symbolBank.querySelectorAll('.symbol')).find(s => s.textContent === sym && s.classList.contains('used'));
            if (original) original.classList.remove('used');
            if (formulaArea.children.length === 0) formulaArea.classList.add('empty');
        });

        formulaArea.appendChild(placed);
        formulaArea.classList.remove('empty');
    }

    formulaArea.addEventListener('dragover', e => e.preventDefault());

    formulaArea.addEventListener('drop', e => {
        e.preventDefault();
        if (draggedSymbol && !draggedSymbol.classList.contains('used')) {
            const sym = draggedSymbol.textContent;
            const color = colors[currentLevel - 1];
            placeSymbol(sym, color);
            draggedSymbol.classList.add('used');
        }
        draggedSymbol = null;
    });

    checkBtn.addEventListener('click', () => {
        const built = Array.from(formulaArea.querySelectorAll('.placed-symbol')).map(el => el.textContent);
        const data = formulae[currentLevel][currentFormulaIndex];

        scores[ACTIVITY_NAME].total++;

        const isCorrect = data.correctOptions.some(option => 
            built.length === option.length && 
            built.every((s, i) => s === option[i])
        );

        const exampleCorrect = data.correctOptions[0].join(" ");

        if (isCorrect) {
            feedbackEl.textContent = '✅ Perfect formula!';
            feedbackEl.style.color = '#4CAF50';
            scores[ACTIVITY_NAME].correct++;
        } else {
            feedbackEl.textContent = `❌ Not quite. One correct version is: ${exampleCorrect}`;
            feedbackEl.style.color = '#FF6B6B';
        }

        localStorage.setItem(STORAGE_KEY, JSON.stringify(scores));
        updateScoreDisplay();

        checkBtn.style.display = 'none';
        nextBtn.style.display = 'inline-block';
    });

    nextBtn.addEventListener('click', () => {
        currentFormulaIndex++;
        if (currentFormulaIndex >= formulae[currentLevel].length) currentFormulaIndex = 0;
        loadFormula();
    });

    resetBtn.addEventListener('click', () => {
        currentFormulaIndex = 0;
        loadFormula();
    });

    navBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            currentLevel = parseInt(btn.dataset.level);
            currentFormulaIndex = 0;
            loadFormula();
        });
    });

    function shuffle(array) {
        const arr = array.slice();
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    function updateActiveButton() {
        navBtns.forEach(btn => {
            btn.classList.remove('active');
        });
        const activeBtn = document.querySelector(`.nav-btn[data-level="${currentLevel}"]`);
        if (activeBtn) activeBtn.classList.add('active');
    }

    updateScoreDisplay();
    loadFormula();
</script>
</body>
</html>
